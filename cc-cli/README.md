# Peanut

åœ¨æ‰‹æœºä¸Šè¿œç¨‹æ§åˆ¶ Claude Code çš„ CLI å·¥å…·ã€‚

## åŠŸèƒ½

- åœ¨ç»ˆç«¯å¯åŠ¨ Claude Code å¹¶ç”Ÿæˆé…å¯¹äºŒç»´ç 
- é€šè¿‡ iOS App æ‰«ç è¿æ¥ï¼Œå®ç°è¿œç¨‹æ§åˆ¶
- å®æ—¶åŒæ­¥ Claude Code çš„è¾“å‡ºåˆ°æ‰‹æœº
- æ”¯æŒåœ¨æ‰‹æœºä¸Šå‘é€æŒ‡ä»¤ã€å¤„ç†æƒé™è¯·æ±‚

## å®‰è£…

```bash
npm install -g peanut-cc@latest
```

> æ³¨æ„ï¼šä½¿ç”¨ `@latest` ç¡®ä¿å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œé¿å… npm ç¼“å­˜é—®é¢˜ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£… Hooksï¼ˆé¦–æ¬¡å®‰è£…å¿…é¡»ï¼‰

```bash
peanut install-hooks
```

> **é‡è¦**ï¼šHooks é…ç½®è®© Claude Code èƒ½å¤Ÿå°†çŠ¶æ€åŒæ­¥åˆ°æ‰‹æœºã€‚é¦–æ¬¡å®‰è£…ååªéœ€æ‰§è¡Œä¸€æ¬¡ã€‚

### 2. å¯åŠ¨ä¼šè¯

```bash
# å¯åŠ¨ä¼šè¯ï¼ˆæ˜¾ç¤ºé…å¯¹äºŒç»´ç ï¼‰
peanut start

# è‡ªå®šä¹‰ä¼šè¯åç§°
peanut start -n "æˆ‘çš„é¡¹ç›®"

# ä½¿ç”¨è‡ªå®šä¹‰ä¸­ç»§æœåŠ¡å™¨ï¼ˆæ¨èæ•æ„Ÿé¡¹ç›®ä½¿ç”¨ï¼‰
peanut start -s "wss://your-relay-server.com"
```

### 3. ç”¨ App æ‰«ç è¿æ¥

æ‰“å¼€ Peanut Appï¼Œæ‰«æç»ˆç«¯ä¸­çš„äºŒç»´ç å³å¯é…å¯¹ã€‚

## å…¶ä»–å‘½ä»¤

```bash
# æ£€æŸ¥ Hooks é…ç½®çŠ¶æ€
peanut check-hooks

# æŸ¥çœ‹ Hooks é…ç½®å†…å®¹ï¼ˆä¸å®‰è£…ï¼‰
peanut install-hooks --show
```

## é…å¥— App

æ‰«æäºŒç»´ç éœ€è¦é…å¥—çš„ iOS Appï¼š**Peanut**

App åŠŸèƒ½ï¼š
- æ‰«ç å¿«é€Ÿé…å¯¹
- å®æ—¶æŸ¥çœ‹ Claude Code è¾“å‡º
- è¿œç¨‹å‘é€æŒ‡ä»¤
- ä¸€é”®å¤„ç†æƒé™è¯·æ±‚

## å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   iOS App   â”‚  â—„â”€â”€â”€â”€â”€ åŒæ­¥ â”€â”€â”€â”€â”€â”€â–º â”‚ peanut startâ”‚
â”‚             â”‚      WebSocket       â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                    â”‚ PTY
       â”‚                             â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
       â–¼                             â”‚ Claude Code â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ äº‘ç«¯ä¸­ç»§æœåŠ¡ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

1. `peanut start` å¯åŠ¨ Claude Codeï¼ŒåŒ…è£…åœ¨ PTY ä¸­
2. è§£æè¾“å‡ºä¸ºç»“æ„åŒ–æ¶ˆæ¯ï¼Œé€šè¿‡ WebSocket å‘é€
3. äº‘ç«¯ä¸­ç»§æœåŠ¡è½¬å‘æ¶ˆæ¯åˆ° iOS App
4. App å¯å‘é€æŒ‡ä»¤å›ä¼ åˆ° CLI

---

## å®‰å…¨è¯´æ˜

### æ•°æ®ä¼ è¾“æœºåˆ¶

é»˜è®¤æƒ…å†µä¸‹ï¼ŒCLI ä½¿ç”¨ä½œè€…æä¾›çš„å…¬å…±ä¸­ç»§æœåŠ¡å™¨ã€‚è¿™æ„å‘³ç€ï¼š

| æ•°æ®ç±»å‹ | æ˜¯å¦ç»è¿‡ä¸­ç»§ | æ˜¯å¦å­˜å‚¨ |
|----------|--------------|----------|
| Claude Code è¾“å‡º | âœ… æ˜¯ | âŒ å¦ï¼ˆä»…è½¬å‘ï¼‰ |
| ç”¨æˆ·è¾“å…¥æŒ‡ä»¤ | âœ… æ˜¯ | âŒ å¦ï¼ˆä»…è½¬å‘ï¼‰ |
| ä¼šè¯å¯†é’¥ | âœ… æ˜¯ | âœ… æ˜¯ï¼ˆç”¨äºé…å¯¹éªŒè¯ï¼‰ |
| ä»£ç /æ–‡ä»¶å†…å®¹ | âœ… æ˜¯ | âŒ å¦ï¼ˆä»…è½¬å‘ï¼‰ |

**é‡è¦æç¤º**ï¼š
- æ¶ˆæ¯å†…å®¹**ä¸ä¼šè¢«æŒä¹…åŒ–å­˜å‚¨**ï¼Œä»…å®æ—¶è½¬å‘
- ä½†æ¶ˆæ¯**ä»¥æ˜æ–‡å½¢å¼**ç»è¿‡ä¸­ç»§æœåŠ¡å™¨
- ä¸­ç»§æœåŠ¡è¿è¥è€…**ç†è®ºä¸Šå¯ä»¥**æŸ¥çœ‹ä¼ è¾“å†…å®¹
- ç›®å‰**æ²¡æœ‰ç«¯åˆ°ç«¯åŠ å¯†**

### ä½•æ—¶åº”è¯¥è‡ªå»ºä¸­ç»§æœåŠ¡ï¼Ÿ

å»ºè®®åœ¨ä»¥ä¸‹åœºæ™¯è‡ªå»ºä¸­ç»§æœåŠ¡ï¼š

- ğŸ” å¤„ç†åŒ…å«æ•æ„Ÿä¿¡æ¯çš„é¡¹ç›®ï¼ˆAPI å¯†é’¥ã€å¯†ç ã€ç§æœ‰ä»£ç ï¼‰
- ğŸ¢ ä¼ä¸š/å•†ä¸šé¡¹ç›®
- ğŸ“‹ æœ‰åˆè§„è¦æ±‚çš„åœºæ™¯ï¼ˆGDPRã€æ•°æ®æœ¬åœ°åŒ–ï¼‰
- ğŸ”’ å¯¹éšç§æœ‰è¾ƒé«˜è¦æ±‚

å…¬å…±ä¸­ç»§æœåŠ¡é€‚åˆï¼š
- ğŸ§ª ä¸ªäººå­¦ä¹ ã€æµ‹è¯•ç”¨é€”
- ğŸ“– å¼€æºé¡¹ç›®å¼€å‘
- ğŸ¯ å¿«é€Ÿä½“éªŒäº§å“åŠŸèƒ½

---

## è‡ªå»ºä¸­ç»§æœåŠ¡

å¦‚æœä½ éœ€è¦å®Œå…¨æ§åˆ¶æ•°æ®ä¼ è¾“ï¼Œå¯ä»¥éƒ¨ç½²è‡ªå·±çš„ä¸­ç»§æœåŠ¡ã€‚

### å‰ç½®è¦æ±‚

- [Cloudflare è´¦å·](https://dash.cloudflare.com/sign-up)ï¼ˆå…è´¹ï¼‰
- [Node.js](https://nodejs.org/) >= 18
- [Wrangler CLI](https://developers.cloudflare.com/workers/wrangler/install-and-update/)

### éƒ¨ç½²æ­¥éª¤

**1. å…‹éš†ä»“åº“**

```bash
git clone https://github.com/alchaincyf/cc-connect.git
cd cc-connect/relay-server
```

**2. å®‰è£…ä¾èµ–**

```bash
npm install
```

**3. ç™»å½• Cloudflare**

```bash
npx wrangler login
```

**4. ä¿®æ”¹é…ç½®**

ç¼–è¾‘ `wrangler.toml`ï¼Œä¿®æ”¹ `name` ä¸ºä½ è‡ªå·±çš„æœåŠ¡åï¼š

```toml
name = "my-peanut-relay"  # æ”¹æˆä½ çš„åå­—
```

**5. éƒ¨ç½²**

```bash
npm run deploy
```

éƒ¨ç½²æˆåŠŸåä¼šæ˜¾ç¤ºä½ çš„æœåŠ¡åœ°å€ï¼Œç±»ä¼¼ï¼š
```
https://my-peanut-relay.ä½ çš„ç”¨æˆ·å.workers.dev
```

**6. ä½¿ç”¨è‡ªå»ºæœåŠ¡**

```bash
peanut start -s "wss://my-peanut-relay.ä½ çš„ç”¨æˆ·å.workers.dev"
```

### Cloudflare å…è´¹é¢åº¦

| èµ„æº | å…è´¹é¢åº¦ | è¯´æ˜ |
|------|----------|------|
| Workers è¯·æ±‚ | 10 ä¸‡æ¬¡/å¤© | è¶³å¤Ÿä¸ªäººä½¿ç”¨ |
| Durable Objects | 100 ä¸‡æ¬¡è¯»å†™/æœˆ | ç”¨äºä¼šè¯ç®¡ç† |
| å­˜å‚¨ | 1 GB | ä»…å­˜å‚¨ä¼šè¯å¯†é’¥ |

å¯¹äºä¸ªäººä½¿ç”¨ï¼Œå…è´¹é¢åº¦å®Œå…¨è¶³å¤Ÿã€‚

---

## å…è´£å£°æ˜

### å…¬å…±ä¸­ç»§æœåŠ¡

æœ¬é¡¹ç›®æä¾›çš„å…¬å…±ä¸­ç»§æœåŠ¡ï¼ˆ`wss://cc-connect.alchaincyf.workers.dev`ï¼‰ï¼š

1. **æŒ‰åŸæ ·æä¾›**ï¼Œä¸ä¿è¯å¯ç”¨æ€§ã€ç¨³å®šæ€§æˆ–å®‰å…¨æ€§
2. **ä¸æ‰¿è¯º**æ•°æ®çš„ä¿å¯†æ€§ï¼Œå°½ç®¡æˆ‘ä»¬ä¸ä¼šä¸»åŠ¨è®°å½•æˆ–æŸ¥çœ‹
3. **ä¸é€‚ç”¨äº**ç”Ÿäº§ç¯å¢ƒæˆ–æ•æ„Ÿæ•°æ®ä¼ è¾“
4. **å¯èƒ½éšæ—¶**åœæ­¢æœåŠ¡æˆ–æ›´æ”¹æ¡æ¬¾
5. **ä¸æ‰¿æ‹…**å› ä½¿ç”¨æœ¬æœåŠ¡é€ æˆçš„ä»»ä½•æŸå¤±

### ç”¨æˆ·è´£ä»»

ä½¿ç”¨æœ¬å·¥å…·å³è¡¨ç¤ºä½ ç†è§£å¹¶åŒæ„ï¼š

- ä½ å¯¹ä¼ è¾“çš„å†…å®¹è´Ÿå…¨éƒ¨è´£ä»»
- ä¸å¾—ä¼ è¾“è¿æ³•ã€ä¾µæƒæˆ–æœ‰å®³å†…å®¹
- æ•æ„Ÿé¡¹ç›®åº”è‡ªå»ºä¸­ç»§æœåŠ¡
- éµå®ˆå½“åœ°æ³•å¾‹æ³•è§„

### å»ºè®®

- ğŸ” æ•æ„Ÿé¡¹ç›®è¯·**åŠ¡å¿…è‡ªå»º**ä¸­ç»§æœåŠ¡
- ğŸ”‘ ä¸è¦åœ¨ä¸ä¿¡ä»»çš„ç½‘ç»œç¯å¢ƒä½¿ç”¨
- ğŸ“ å®šæœŸæ£€æŸ¥å’Œè½®æ¢å¯èƒ½æš´éœ²çš„å¯†é’¥

---

## ç³»ç»Ÿè¦æ±‚

- **Node.js 18.x æˆ– 20.x (LTS)**
  - æ¨èä½¿ç”¨ LTS ç‰ˆæœ¬ï¼Œé LTS ç‰ˆæœ¬ï¼ˆå¦‚ v21ã€v23ï¼‰å¯èƒ½é‡åˆ°åŸç”Ÿæ¨¡å—ç¼–è¯‘é—®é¢˜
  - å¦‚é‡ `posix_spawnp failed` é”™è¯¯ï¼Œè¯·åˆ‡æ¢åˆ° Node LTS ç‰ˆæœ¬
- å·²å®‰è£… Claude Code (`npm install -g @anthropic/claude-code`)
- macOS/Linuxï¼ˆWindows æš‚ä¸æ”¯æŒï¼‰

### å¸¸è§é—®é¢˜

**Q: å®‰è£…åè¿è¡ŒæŠ¥é”™ `posix_spawnp failed`**

A: è¿™æ˜¯å› ä¸º `node-pty` åŸç”Ÿæ¨¡å—ä¸å½“å‰ Node ç‰ˆæœ¬ä¸å…¼å®¹ã€‚è§£å†³æ–¹æ¡ˆï¼š

```bash
# æ–¹æ¡ˆ 1: åˆ‡æ¢åˆ° Node LTS ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
nvm install 20
nvm use 20
npm install -g peanut-cc

# æ–¹æ¡ˆ 2: æ‰‹åŠ¨é‡æ–°ç¼–è¯‘ï¼ˆéœ€è¦ Xcode å‘½ä»¤è¡Œå·¥å…·ï¼‰
cd $(npm root -g)/peanut-cc
npm rebuild node-pty
```

## å¼€æºåè®®

MIT

## ä½œè€…

èŠ±å” ([@alchaincyf](https://github.com/alchaincyf))

---

## é—®é¢˜åé¦ˆ

- GitHub Issues: https://github.com/alchaincyf/cc-connect/issues
